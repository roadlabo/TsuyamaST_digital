# 津山駅サイネージ
# 産業用PC セットアップマニュアル【初心者向け・端的・BAT起動統一版】

## 冒頭に必ず確認すること
- 管理者ユーザー：**SystemAV**
- 管理者ログオンパスワード：**kanrisya**
- この手順は**上から順にそのまま実行する。**
- **ファイル名・フォルダ名は絶対に変更しない。**

## **【重要】フォルダ共有方式について（必ず読む）**
このシステムでは、**フォルダ共有は必ず1か所のみ**とする。

- 共有するフォルダ：  
  `C:\_TsuyamaSignage`
- 共有名：  
  `_TsuyamaSignage`

以下のような共有は **すべて誤り**であり、システムは正常に動作しない。

- app フォルダだけを共有する
- config / logs / content を個別に共有する
- 複数の共有を同時に設定する

**必ず `C:\_TsuyamaSignage` を丸ごと1本で共有すること。**

---

## 作業全体の流れ（この順番で固定）
1. ディスプレイの向き（縦）を確定
2. 壁紙（サイネージ番号）を設定
3. USBから C:\_TsuyamaSignage をコピー
4. 画面が消えない設定（スリープ無効）
5. WindowsファイアーウォールをOFF
6. フォルダ共有（C:\_TsuyamaSignage を丸ごと1本で共有）
7. IPアドレス固定
8. 自動ログイン設定（SystemAV / kanrisya）
9. タスクスケジューラ設定（本番＝BAT起動）
10. 時計同期（閉鎖ネットワーク）
11. 再起動して自動再生を確認

---

## 変更しない事項（必ず守る）
- C:\_TsuyamaSignage フォルダ構成
- フォルダ共有は **C:\_TsuyamaSignage のみ**
- config / logs / content を個別に共有しない
- 共有名は **_TsuyamaSignage 固定**
- BATファイル名（start_auto_play.bat / start_pc_agent.bat）

---

## 1. ディスプレイの向き（縦）を確定
**操作不能防止のため、最初に実施する。**

1. デスクトップの何もないところで右クリック
2. 表示されたメニューから「ディスプレイ設定」をクリック
3. 設定画面の「画面の向き」をクリック
4. 表示される選択肢から **「縦」または「縦（反対向き）」** を選ぶ
5. 画面が切り替わったら「変更を保持する」をクリック

**確認方法**
- 設定画面の「画面の向き」が **「縦」または「縦（反対向き）」** と表示されていることを確認する。

---

## 2. 壁紙（サイネージ番号）を設定
**サイネージ番号＝壁紙に書いている番号。必ず一致させる。**

1. デスクトップの何もないところで右クリック
2. 表示されたメニューから「個人用設定」をクリック
3. 左側の「背景」をクリック
4. 「写真を参照」をクリック
5. USB内の壁紙フォルダから番号画像をクリックして選ぶ
   - 例：01番 → `signage_01.png`

**確認方法**
- デスクトップ背景に、選んだ番号が大きく表示されていることを確認する。

---

## 3. USBから C:\_TsuyamaSignage をコピー
1. USBメモリを挿す
2. エクスプローラーを開く
3. 左側の「このPC」からUSBドライブをクリック
4. USB内の **_TsuyamaSignage** を右クリック
5. 表示されたメニューから「コピー」をクリック
6. 左側の「Windows (C:)」をクリック
7. 右側の空白部分で右クリック
8. 表示されたメニューから「貼り付け」をクリック

**注意**
- フォルダ名は変更しない
- Cドライブ直下に置く

**確認方法**
- エクスプローラーで `C:\_TsuyamaSignage` が表示され、開けることを確認する。

---

## 4. 画面が消えない設定（スリープ無効）
1. スタートボタンをクリック
2. 表示された「設定」をクリック
3. 「システム」をクリック
4. 「電源とバッテリー」をクリック
5. 「画面とスリープ」をクリック
6. 表示される全項目を **「なし」** に変更する

**確認方法**
- 「画面とスリープ」のすべての項目が **「なし」** になっていることを確認する。

---

## 5. WindowsファイアーウォールをOFF
1. スタートボタンをクリック　→　プライバシーとセキュリティー
2. 表示された一番上の「Windows セキュリティ」をクリック
3. 「ファイアーウォールとネットワーク保護」をクリック
4. 「ドメインネットワーク」をクリックし、「ファイアーウォール」を「オフ」に切り替える
5. 戻るボタンで前の画面に戻る
6. 「プライベートネットワーク」をクリックし、「ファイアーウォール」を「オフ」に切り替える
7. 戻るボタンで前の画面に戻る
8. 「パブリックネットワーク」をクリックし、「ファイアーウォール」を「オフ」に切り替える

**確認方法**
- 「ファイアーウォールとネットワーク保護」の3項目が **「オフ」** と表示されていることを確認する。

---

## 6. フォルダ共有（C:\_TsuyamaSignage を丸ごと1本で共有）
この作業は **遠隔操作・再起動・コンテンツ更新のために必須**である。  
設定を間違えると、管理PCから操作できなくなる。

### 6-1 共有するフォルダを確認
1. エクスプローラーを開く
2. 左側の「Windows (C:)」をクリック
3. `C:\_TsuyamaSignage` フォルダが表示されることを確認する

---

### 6-3 C:\_TsuyamaSignage を共有する
1. `C:\_TsuyamaSignage` を右クリック
2. 表示されたメニューから「その他のオプションを表示」をクリック
3. 「アクセスを許可する」をクリック
4. 表示されたサブメニューで「特定のユーザー」をクリック
5. 共有設定の画面で「Everyone」をクリック
6. 「追加」をクリック
7. 「権限レベル」をクリックし、表示された一覧から「読み取り/書き込み」を選ぶ
8. 「共有」をクリック
9. 「完了」をクリック

**確認方法**
- 共有設定画面に「Everyone」が表示され、権限レベルが「読み取り/書き込み」になっていることを確認する。

---

### 6-4 共有確認（必ず実施）
1. エクスプローラーのアドレスバーをクリック
2. 次の文字を入力して Enter を押す

```
\\localhost\_TsuyamaSignage
```

3. 画面に表示されたフォルダ一覧を確認する

---

## 7. IPアドレス固定
**壁紙番号と必ず一致。**

- 範囲：`192.168.1.51 ～ 192.168.1.70`
- 末尾2桁　-　50　＝　サイネージ番号
- サブネットマスク：`255.255.255.0`

| サイネージ番号 | PC名（任意） | 固定IP |
|---:|---|---|
| Sign01 | Sign01 | 192.168.1.51 |
| Sign02 | Sign02 | 192.168.1.52 |
| Sign03 | Sign03 | 192.168.1.53 |
| Sign04 | Sign04 | 192.168.1.54 |
| Sign05 | Sign05 | 192.168.1.55 |
| Sign06 | Sign06 | 192.168.1.56 |
| Sign07 | Sign07 | 192.168.1.57 |
| Sign08 | Sign08 | 192.168.1.58 |
| Sign09 | Sign09 | 192.168.1.59 |
| Sign10 | Sign10 | 192.168.1.60 |
| Sign11 | Sign11 | 192.168.1.61 |
| Sign12 | Sign12 | 192.168.1.62 |
| Sign13 | Sign13 | 192.168.1.63 |
| Sign14 | Sign14 | 192.168.1.64 |
| Sign15 | Sign15 | 192.168.1.65 |
| Sign16 | Sign16 | 192.168.1.66 |
| Sign17 | Sign17 | 192.168.1.67 |
| Sign18 | Sign18 | 192.168.1.68 |
| Sign19 | Sign19 | 192.168.1.69 |
| Sign20 | Sign20 | 192.168.1.70 |

手順：
1. スタートボタンをクリック
2. 表示された「設定」をクリック
3. 「ネットワークとインターネット」をクリック
4. 「イーサネット」をクリック
5. 「IP割り当て」の右側にある「編集」をクリック
6. 表示された画面で「手動」を選び、「IPv4」を「オン」にする
7. IPアドレスとサブネットマスクを入力する
8. 「保存」をクリック

**確認方法**
- `Windows + R` を押し、「cmd」と入力して「OK」をクリック
- コマンドプロンプト（黒い画面）で `ipconfig` と入力して Enter を押し、表示されたIPアドレスが設定値と一致していることを確認する。

---

## 8. 自動ログイン設定（SystemAV / kanrisya）
**管理者ユーザー：SystemAV**  
**管理者ログオンパスワード：kanrisya**

### 8-1 管理者パスワード設定
1. SystemAVでログイン
2. スタートボタンをクリック
3. 表示された「設定」をクリック
4. 「アカウント」をクリック
5. 「サインイン オプション」をクリック
6. 「パスワード」の欄にある「追加」をクリック
7. 新しいパスワードに `kanrisya` を入力
8. 画面の指示に従って完了する

**確認方法**
- サインイン オプション画面の「パスワード」に「変更」ボタンが表示されていることを確認する。

### 8-2 自動ログイン（レジストリ）
1. `Windows + R` を押す
2. 表示された「ファイル名を指定して実行」に `regedit` と入力
3. 「OK」をクリック
4. レジストリエディターで次の場所を開く（ひとつづつクリックして目的まで到達する）

```
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon
```

5. 右側の一覧で以下3つの文字列値を設定する
   - `AutoAdminLogon` = `1`
   - `DefaultUserName` = `SystemAV`　　（新規）
   - `DefaultPassword` = `kanrisya`　　（新規）
6. レジストリエディターを閉じる
7. PCを再起動する

**確認方法**
- 再起動後にログイン画面が表示されず、自動でSystemAVが起動することを確認する。

---

## HP Wolf Security / HP Wolf Security Console のアンインストール
### 1. 目的
HP製PCに標準搭載されている HP Wolf Security は、  
無人運用・常時稼働を前提とするサイネージ／防犯カメラ用途では、  
起動遅延やCPU負荷、不要な常駐監視の原因となるため削除する。

### 2. 対象ソフト
以下の2つを必ずアンインストールする。
- HP Wolf Security
- HP Wolf Security Console

※ どちらか一方のみ残すと警告表示や再インストールが発生する場合がある。

### 3. アンインストール手順
1. スタートボタンを右クリックし「インストールされているアプリ」を開く
2. 一覧から「HP Wolf Security」を探し、︙（三点）→「アンインストール」を選択する
3. 確認画面でも「アンインストール」を選択し、処理完了まで待つ
4. 自動で再起動される
5. 同様に「HP Wolf Security Console」もアンインストールする

### 4. もう一度再起動（必須）
アンインストール完了後、必ずPCを再起動する。  
再起動しない場合、サービスや常駐プロセスが残る。

### 5. 確認
再起動後、以下を確認する。
- アプリ一覧に「HP Wolf Security」「HP Wolf Security Console」が存在しないこと
- タスクマネージャーのプロセス一覧に Wolf / HP Security / Sure Click 系のプロセスが存在しないこと

### 6. 注意事項
- 管理者権限でログオンした状態で実施すること
- 本システムでは HP Wolf Security を使用しない
- Windows Update 後に復活した場合も同手順で再度削除する

備考：  
本システムは「無人運用・遠隔管理・常時稼働」を前提とするため、  
個人向けセキュリティ常駐ソフトは導入しない。

---

## 9. タスクスケジューラ設定
**方針（必ず守る）**  
タスクスケジューラが起動するのは **.bat のみ。**

### 9-1 作成するタスクは2つだけ

**1 サイネージPCの管理**

＜全般＞
- 名前：Tsuyama PC Agent Auto Start
- 説明：コンピューター情報のjson書き出し、再起動とシャットダウンの遠隔指示を受ける
- ●ユーザーがログオンしているかどうかにかかわらず実行する
- ■最上位の特権で実行する

＜トリガー＞
- 新規(N)
- タスクの開始：スタートアップ時
- ■遅延時間を指定する：1分

＜操作＞
- 新規(N)
- プログラムの開始
- プログラム/スクリプト（P）：参照
- `C:\_TsuyamaSignage\app\signagePC\start_pc_agent.bat`

＜条件＞
- 変更なし（何もしない）

＜設定＞
- 変更なし（何もしない）

**2 動画のオートプレイ**

＜全般＞
- 名前：Tsuyama Auto Play Start
- 説明：動画自動再生（サイネージ）
- ●ユーザーがログオンしているときのみ実行する

＜トリガー＞
- 新規(N)
- タスクの開始：ログオン時
- ■遅延時間を指定する：30秒

＜操作＞
- 新規(N)
- プログラムの開始
- プログラム/スクリプト（P）：参照
- `C:\_TsuyamaSignage\app\signagePC\start_auto_play.bat`

＜条件＞
- 変更なし（何もしない）

＜設定＞
- 変更なし（何もしない）

### 9-2 共通ルール
- タスク作成時にパスワードを求められたら **kanrisya** を入力

### 9-3 各タスクの指定内容

**確認方法**
- タスクスケジューラの一覧に上記2つのタスク名が表示されることを確認する。
- 各タスクの「操作」タブに、指定したプログラム/スクリプトのパスが表示されていることを確認する。

---

## 10. 時計同期（閉鎖ネットワーク）
このシステムはインターネットに接続しない閉鎖ネットワークで運用する。  
そのため、**管理用PC（AI解析用事務所PC）を時刻の基準（親）**とし、サイネージPCの時刻を可能な範囲で一致させる。  
※ 時刻同期は「安全第一」。勝手に時計を変更しないことを最優先とする。

### 10-1 基本方針（重要）
- 管理用PCが見つかる（応答する）場合のみ、時刻同期を行う
- 管理用PCが見つからない場合は、**何もしない**
- 時刻同期の失敗は **異常ではない**
- 「古い時刻に合わせてしまう」方が危険なので、無理に直さない

### 10-2 サイネージPCの動作（1日1回）
サイネージPCでは、Windows標準の時刻同期コマンドを **1日1回** 実行する。

実行コマンド：  
w32tm /resync /force

動作ルール：
- 管理用PCが応答する → 時刻が補正される
- 管理用PCが停止中／通信不可 → 同期は失敗するが、**時計は変更されない**
- 失敗しても運用には影響しない（異常扱いしない）

### 10-3 タスクスケジューラ設定（追加で1つだけ作る）
作成するタスクは1つだけ。

| タスク名 | 起動するもの | トリガー | 遅延 |
|---|---|---|---|
| Tsuyama Time Sync (Daily) | w32tm /resync /force | 毎日 | なし |

設定内容：
- トリガー：毎日（例：04:00）
- 操作：
  - プログラム/スクリプト：`w32tm`
  - 引数の追加：`/resync /force`
- セキュリティオプション：可能なら `SYSTEM` で実行（推奨）
- 失敗しても問題ない（時計は変わらないため）

確認方法：
- コマンドプロンプトまたはPowerShellで以下を実行し、エラーが出ても「時計が変な値になっていない」ことを確認する。  
w32tm /query /status

---

## 11. 再起動して自動再生を確認
1. スタートボタンをクリック
2. 電源マークをクリック
3. 「再起動」をクリック
4. 再起動後は何も触らず待つ

**確認方法**
- 自動で再生が始まることを確認する。

---

## 12. 遠隔監視で見る項目（温度なし）
### 正常判定（最低ライン）
- `logs/status/pc_status.json` の `timestamp` が **更新され続ける**。
- 再生状態が「再生中」になっている。

### 異常判定（目安）
- 最終更新が **30秒以上止まる** → `pc_agent` 停止/フリーズ疑い
- 再生状態が「停止」 → `auto_play` 未起動
- 再生状態が「固まり疑い」 → `auto_play` は居るが再生が進んでいない
- Cドライブ使用率が高い（例：**90%超**） → 要対応

---

## よくある失敗（必ず確認）
- 共有名を変更してしまう → ❌
- フォルダ名を変更する → ❌

**共有は必ず「C:\_TsuyamaSignage を丸ごと1本」だけ。**

---

## 困ったときはこれだけ
- 動かない → **C:\_TsuyamaSignage をコピーし直す**
- 触っていいのは → **content フォルダだけ**
- それ以外は → **触らない**
