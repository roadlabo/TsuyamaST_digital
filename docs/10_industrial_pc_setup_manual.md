# 津山駅サイネージ
# 産業用PC セットアップマニュアル【完全初心者対応・超詳細版】

## はじめに（重要）
このマニュアルは、
**パソコンに詳しくない人が、上から順にそのまま操作するだけでサイネージを動かせること** を目的に書いています。

意味が分からなくても、**書いてある通りにクリック** してください。

---

## 作業全体の流れ（先に全体像）
1. USBを挿してフォルダをコピーする
2. 画面が勝手に消えないように設定する
3. ネットワーク制限（Windowsファイアーウォール）を解除する
4. フォルダ共有を設定する（app/config・logs・content）
5. 電源ONで自動起動するように設定する
6. ディスプレイの向きを確認・調整する
7. 壁紙にサイネージ番号を表示する
8. IPアドレスを番号に合わせて固定する
9. 作業完了の確認をする
10. ログインパスワードを不要にする（自動ログイン）
11. 再起動して、勝手に動画が出るか確認する

---

## 構成の前提（必ず一致させる）
このプロジェクトは **GitHub / マスターUSB / 現地PC が完全に同一構成** です。  
**フォルダ構成は GitHub と USB で同一** です。

### Python は 2 本のみ
- 再生: `app/signagePC/auto_play.py`
- PC管理: `app/signagePC/pc_agent.py`
  - 再起動／シャットダウン
  - 温度ログ
  - truncate
  - 容量監視

### 正しいフォルダ構成（C:\_TsuyamaSignage）
```
C:\_TsuyamaSignage\
  app\
    analysisPC\
    config\
    signagePC\
  content\
  docs\
  logs\
  runtime\
    python\
    mpv\
    hwinfo\
```

## ① USBからフォルダをコピーする（最重要）

### ①-1 USBを挿す
産業用PCのUSB差込口に、**セットアップ用USBメモリ**を挿してください。

### ①-2 USBを開く
1. 画面左下の **Windowsマーク（スタートボタン）** をクリック
2. 表示されたメニューの中から **「エクスプローラー」** をクリック
   - 黄色いフォルダのアイコンです

### ①-3 `_TsuyamaSignage` をコピー
1. 左側の一覧から **「USBドライブ（E:）」** をクリック
   - **E:** 以外の文字でもOK（「USB」と書いてあるもの）
2. 右側に **「_TsuyamaSignage」** というフォルダが見えることを確認
3. **_TsuyamaSignage** を右クリック
4. 表示されたメニューから **「コピー」** をクリック

### ①-4 Cドライブに貼り付け
1. 左側の一覧から **「ローカル ディスク（C:）」** をクリック
2. 右側の白い何もないところで **右クリック**
3. 表示されたメニューから **「貼り付け」** をクリック
4. コピーが終わるまで待つ（数十秒〜数分）

### ①-5 確認
以下の場所にフォルダがあれば成功です。

```
C:\_TsuyamaSignage
```

**⚠ 注意**
- フォルダ名を変えない
- **C:\ の直下** にあることが重要

---

## ② 画面が勝手に消えない設定（必須）

### ②-1 設定画面を開く
1. 画面左下の **Windowsマーク** をクリック
2. **歯車マーク（設定）** をクリック

### ②-2 電源設定を開く
1. 左側メニューから **「システム」** をクリック
2. 右側を下にスクロール
3. **「電源とバッテリー」** をクリック

### ②-3 スリープを無効にする
1. **「画面とスリープ」** という項目を探す
2. 次の項目をすべて **「なし」** に変更する
   - 画面をオフにする → なし
   - スリープ状態にする → なし
3. プルダウンをクリックして **「なし」** を選ぶ

---

## ③ WindowsファイアーウォールをOFFにする

### ③-1 セキュリティ設定を開く
1. **Windowsマーク** をクリック
2. キーボードで **「Windows セキュリティ」** と入力
3. 表示された **「Windows セキュリティ」** をクリック

### ③-2 ファイアーウォール画面を開く
1. 左側メニューから **「ファイアーウォールとネットワーク保護」** をクリック

### ③-3 3つともOFFにする

#### ① ドメインネットワーク
1. **「ドメインネットワーク」** をクリック
2. **「Microsoft Defender ファイアーウォール」** を **オフ** にする
3. 左上の **←** をクリックして戻る

#### ② プライベートネットワーク
1. **「プライベートネットワーク」** をクリック
2. **「Microsoft Defender ファイアーウォール」** を **オフ** にする
3. 左上の **←** をクリックして戻る

#### ③ パブリックネットワーク
1. **「パブリックネットワーク」** をクリック
2. **「Microsoft Defender ファイアーウォール」** を **オフ** にする
3. 左上の **←** をクリックして戻る

### ③-4 確認
3つすべてに **「ファイアーウォールはオフです」** と表示されていればOK

---

## ④ フォルダ共有の設定（app/config・logs・content）

### ④-1 共有対象フォルダを開く
1. **エクスプローラー** を開く
2. 次のフォルダを開く

```
C:\_TsuyamaSignage\
```

3. `app\config`、`logs`、`content` の3フォルダが存在することを確認する

### ④-2 config を共有する
1. `app\config` を右クリックする
2. **「その他のオプションを確認」** をクリックする
3. **「アクセスを許可する」** をクリックする
4. **「特定のユーザー」** をクリックする
5. プルダウンから **「Everyone」** を選び **「追加」** をクリックする
6. アクセス許可のレベルを **「読み取り/書き込み」** に変更する
7. **「共有」** ボタンをクリックする
8. 表示されたネットワークパスを控える（例：`\\<PC名>\config`）

### ④-3 logs を共有する
1. `logs` を右クリックする
2. **「その他のオプションを確認」** をクリックする
3. **「アクセスを許可する」** をクリックする
4. **「特定のユーザー」** をクリックする
5. プルダウンから **「Everyone」** を選び **「追加」** をクリックする
6. アクセス許可のレベルを **「読み取り/書き込み」** に変更する
7. **「共有」** ボタンをクリックする
8. 表示されたネットワークパスを控える（例：`\\<PC名>\logs`）

### ④-4 content を共有する
1. `content` を右クリックする
2. **「その他のオプションを確認」** をクリックする
3. **「アクセスを許可する」** をクリックする
4. **「特定のユーザー」** をクリックする
5. プルダウンから **「Everyone」** を選び **「追加」** をクリックする
6. アクセス許可のレベルを **「読み取り/書き込み」** に変更する
7. **「共有」** ボタンをクリックする
8. 表示されたネットワークパスを控える（例：`\\<PC名>\content`）

### ④-5 共有状態の最終確認を行う
1. エクスプローラーのアドレスバーに `\\localhost\config` を入力し、開けることを確認する
2. 同様に `\\localhost\logs`、`\\localhost\content` が開けることを確認する

---

## ⑤ 電源ONで自動起動する設定（必須）

### ⑤-1 タスクスケジューラを開く
1. **Windowsマーク** をクリック
2. キーボードで **「タスク スケジューラ」** と入力
3. **「タスク スケジューラ」** をクリック

### ⑤-2 新しいタスクを作成
1. 右側の **「タスクの作成」** をクリック

### ⑤-3（追加） pc_agent を自動起動する設定（年次ログ生成）

### ⑤-3-0 pc_agent とは何か？
pc_agent は **「裏方のプログラム」** です。  
画面は **出ない（または最小限）** ので、動いていても気づきにくいです。

**役割は3つだけ：**
1. **HWiNFO が出力した CSV** を読む  
2. **30分に1回だけ** 必要な項目を取り出す  
3. **年次CSV（1年分の記録）** を作り続ける  

**重要：**  
HWiNFO が止まっていると pc_agent も意味がありません。  
そのため、**HWiNFO → pc_agent の順で起動する必要があります。**

### ⑤-3-1 pc_agent の場所を確認する
初心者の方は、まず **エクスプローラーで場所を確認** してください。

例（既存構成の場合）：  
- `C:\_TsuyamaSignage\app\signagePC\pc_agent.py`

**補足：**  
場所が違う場合は、**後のタスク設定でその場所を指定** してください。

### ⑤-3-2 手動で1回だけ起動テスト（重要）
いきなり自動起動させず、**最初に手動で起動テスト** を行います。

**手順：**
1. エクスプローラーを開く
2. `C:\_TsuyamaSignage\app\signagePC\` を開く
3. **pc_agent.py をダブルクリック** または  
   **「右クリック → 開く」**
4. 何も起きない／黒い画面が一瞬出て消えてもOK
5. **エラーが出なければ成功**

**注意：**
- 画面が出ないのは正常です
- ここでエラーが出る場合は、**先に環境構築を見直す**

### ⑤-3-3 タスクスケジューラで pc_agent を自動起動する

#### (A) 新しいタスクを作る
- **タスク名：**  
  `pc_agent Auto Start`
- **説明：**  
  サイネージ・温度監視用 pc_agent 自動起動

#### (B) ［全般］タブ
- **「ユーザーがログオンしているかどうかにかかわらず実行する」**：選択
- **「最上位の特権で実行する」**：チェック
- **構成：** Windows 10 / Windows 11

**※パスワードを求められたら**
- Windowsログイン時のパスワードを入力
- 分からない場合は **管理者へ連絡**

#### (C) ［トリガー］タブ
- **新規**
- **開始：** コンピューターの起動時
- **遅延：2分**

**理由：**  
HWiNFO が先に起動し、CSV を作り始めるのを待つため。

#### (D) ［操作］タブ
- **新規**
- **操作：** プログラムの開始

**プログラム/スクリプト：**  
Python を直接指定する方法（初心者向けで安定）

例：  
`C:\_TsuyamaSignage\runtime\python\python.exe`

**※もし python.exe の場所が違う場合：**  
既存の **「Python環境構築」** の章を参照する。

**引数の追加：**  
`C:\_TsuyamaSignage\app\signagePC\pc_agent.py`

**開始（オプション）：**  
`C:\_TsuyamaSignage\app\signagePC`

#### (E) ［条件］タブ
- **「AC電源の場合のみ開始する」**：チェックを外す（ある場合）

#### (F) ［設定］タブ
- **「スケジュールされた開始時刻を過ぎた場合、すぐにタスクを実行する」**：ON
- **「既に実行中の場合は、新しいインスタンスを開始しない」**：ON
- **「タスクが失敗した場合の再起動」**：そのまま（触らない）

### ⑤-3-4 pc_agent の動作確認（必須）
1. PCを再起動
2. ログイン後、**3分待つ**
3. 以下を確認する（チェックリスト）

- [ ] **タスクスケジューラ**  
  `pc_agent Auto Start` が **「実行中」または「実行済み」**
- [ ] **フォルダ確認：**  
  `C:\_TsuyamaSignage\logs\hwinfo\yearly\`  
  `hwinfo_2026.csv`（年に応じたファイル）が存在
- [ ] **ファイル内容：**  
  ファイルを開き、**行が増えていること** を確認

### ⑤-3-5 よくある失敗と直し方（pc_agent編）

#### pc_agent が動かない
- python.exe のパスが正しいか
- 引数に pc_agent.py のフルパスが入っているか
- 開始（オプション）が app フォルダになっているか

#### 年次CSVができない
- HWiNFO が起動しているか
- hwinfo_sensors.csv が存在し、サイズが増えているか
- 30分経過しているか（テスト時は時間短縮設定がある場合もある）

#### 同じ行が何度も書かれる
- state.json が存在するか
- pc_agent を二重起動していないか

### ⑤-4 全般タブ
1. **名前** に次を入力
   - `TsuyamaSignage Auto Start`
2. **「ユーザーがログオンしているときのみ実行する」** を選択
3. **「最上位の特権で実行する」** にチェック
4. **「ユーザーまたはグループの変更」** をクリック
5. **ユーザー名** に **SystemAV** を入力 → **名前の確認** → **OK**

### ⑤-5 トリガータブ
1. **「新規」** をクリック
2. **開始：** から **「ログオン時」** を選ぶ
3. **ユーザー：** **SystemAV** を選ぶ
4. **「遅延時間」** を **30秒** に設定
5. **OK** をクリック

**⚠ 重要（必ず守る）**
- 起動直後はOSの初期化が終わっておらず、**30秒遅延** を入れることで正常に発火します。

### ⑤-6 操作タブ
1. **「新規」** をクリック
2. **プログラム/スクリプト：** に次を入力

```
C:\_TsuyamaSignage\runtime\python\python.exe
```

3. **引数の追加（オプション）：** に次を入力

```
C:\_TsuyamaSignage\app\signagePC\auto_play.py
```

4. **開始（オプション）：** に次を入力

```
C:\_TsuyamaSignage\app\signagePC
```

3. **OK** をクリック

### ⑤-7 運用するPythonは2本だけ（重要）
- **再生：** `app/signagePC/auto_play.py`（サイネージ再生）
- **管理：** `app/signagePC/pc_agent.py`（温度ログ・容量・保守）
- **温度ログ機能は `pc_agent.py` に内蔵**（別ファイル不要）

### ⑤-8 タスクスケジューラは3つに分ける
起動時の遅延は以下で統一する（既存方針を維持）。

1. **HWiNFO64.exe**  
   - 起動時  
   - **遅延 30秒**
2. **auto_play.py**  
   - 起動時  
   - **遅延 1分**（既存方針に合わせる）
3. **pc_agent.py**  
   - 起動時  
   - **遅延 2分**

### ⑤-9 保存
1. **OK** をクリックして閉じる

※⑤-2 は温度監視（HWiNFO）、⑤-3 はログ集計（pc_agent）。両方設定することで無人運用が完成する。

---

## ⑥ ディスプレイの向き設定（最優先・必須）

### ⑥-1 目的
サイネージは **縦長表示が前提** です。  
設置状況により **「縦」または「縦（反対向き）」** になるため、先に画面の向きを確定させます。

**重要**
- 壁紙設定より **先に** 実施する

### ⑥-2 設定手順（GUI操作）
1. デスクトップの何もないところで **右クリック**
2. **「ディスプレイ設定」** をクリック
3. **「画面の向き」** を探す
4. 以下を順に試す
   - **縦**
   - **縦（反対向き）**
5. 画面上の文字が正しい上下方向で縦長表示になる方を選択
6. **「変更を保持する」** をクリック

**確認ポイント**
- マウス操作が直感的
- 文字・映像が上下逆でない

👉 問題なければ次へ進む

---

## ⑦ 壁紙にサイネージ番号を表示する（必須）

### ⑦-1 目的
現地で **「この画面が何番のサイネージか」** をすぐ判別できるようにします。

**重要ルール**
- **壁紙の番号＝IPアドレスの下2桁** を必ず一致させる

### ⑦-2 壁紙のルール（運用）
- USB内の **壁紙フォルダ** に、サイネージ番号 **01〜20** の画像がある
- 設置するPCの番号に対応した画像を壁紙に設定する

### ⑦-3 設定手順（GUI操作）
1. デスクトップの何もないところで **右クリック**
2. **「個人用設定」** をクリック
3. 左メニューから **「背景」** をクリック
4. **「背景をカスタマイズ」** → **画像**
5. **「写真を参照」** をクリック
6. USB内の壁紙フォルダを開く
7. 該当する番号の画像を選択  
   例：サイネージ01 → `signage_01.png`
8. **「適用」**

**OK判定**
- デスクトップ背景に番号が大きく表示されていればOK

---
## ⑧ IPアドレス固定（手動設定）

### ⑧-1 IP割り当てルール（厳守）
- **IPアドレス範囲：** `192.168.1.201 ～ 192.168.1.220`
- **下2桁 ＝ サイネージ番号**
  - サイネージ01 → `192.168.1.201`
  - サイネージ02 → `192.168.1.202`
  - …
  - サイネージ20 → `192.168.1.220`
- **サブネットマスク：** `255.255.255.0`（固定）

**重要**
- **壁紙の番号＝IPアドレスの下2桁** を必ず一致させる

### ⑧-2 設定画面を開く
1. **設定** を開く
2. **ネットワークとインターネット** を開く
3. **イーサネット** を開く

### ⑧-3 IP割り当てを手動にする
1. **「IP割り当て」** の右側にある **「編集」** ボタンをクリックする
2. **「手動」** を選択する
3. **「IPv4」** をオンにする

### ⑧-4 IP情報を入力して保存する
1. IPアドレスを **192.168.1.201～220** の範囲で設定する（産業用PCごとに重複しない値を割り当てる）
2. サブネットマスクを **255.255.255.0** に設定する
3. **「保存」** をクリックする

### ⑧-5 設定反映を確認する
1. **コマンドプロンプト（cmd）** を開く
2. `ipconfig` を実行する
3. **IPv4アドレス** が設定した値になっていることを確認する
4. **サブネットマスク** が **255.255.255.0** になっていることを確認する

---

## ⑨ 作業完了の確認（必須）

以下すべて満たすこと。

- ディスプレイが正しい **縦向き**
- 壁紙に正しい **サイネージ番号**
- **IPアドレス下2桁** と **壁紙番号** が一致

---

## ⑩ ログインパスワードを不要にする設定（自動ログイン）

### ⑩-0 これは何のための設定か？（超重要）
通常のWindowsは、

- 電源ON
- ログイン画面が表示
- ユーザー名・パスワード入力

という流れになります。

しかしサイネージでは、
**電源が入ったら何も聞かれず動いてほしい** ため、
**ログイン画面を出さず、自動でログインする設定** を行います。

**⚠ 注意（必ず読む）**
- この設定では **レジストリを変更** します
- **決められた場所・項目・値だけ** を変更します
- **指定以外のキーは変更・削除しない**
- **大文字・小文字は完全一致**
- **値の前後に空白を入れない**

### ⑩-1 管理者アカウントのパスワード設定（必須）
対象ユーザーは **SystemAV（Administrators）** です。

**設定するパスワード**
- `kanrisya`

**手順（GUI操作）**
1. Windows に **SystemAV** でログイン
2. **設定** → **アカウント** → **サインイン オプション**
3. **「パスワード」** を開く
4. **「追加」** をクリック
5. **新しいパスワード：** `kanrisya`
6. **確認用パスワード：** `kanrisya`
7. **完了**

**補足**
- 初期状態ではパスワード未設定のため、表示は **「変更」ではなく「追加」** が正しい。

### ⑩-2 レジストリエディターを開く
1. キーボードで **Windowsキー + R** を同時に押す
2. **「ファイル名を指定して実行」** という小さい画面が出る
3. 入力欄に次をそのまま入力

```
regedit
```

4. **OK** をクリック
5. 「このアプリが変更を加えることを許可しますか？」
   - **はい** をクリック

### ⑩-3 目的の場所へ移動する
左側にフォルダのような一覧が見えます。以下の順番でクリックして開いてください。

```
HKEY_LOCAL_MACHINE
 └ SOFTWARE
    └ Microsoft
       └ Windows NT
          └ CurrentVersion
             └ Winlogon
```

- 最後に **Winlogon** をクリック
- 右側にたくさんの項目が表示されます

### ⑩-4 変更・確認する項目（3項目のみ）
**この3つ以外は絶対に触らない。**

#### ① AutoAdminLogon（なければ作成）
- **種類：** 文字列値（REG_SZ）
- **値：** `1`

**手順**
1. 右側で **AutoAdminLogon** を探す
2. 見つからない場合は **右クリック → 新規 → 文字列値** で作成
3. **AutoAdminLogon** をダブルクリック
4. **「値のデータ」** を `1` に変更
5. **OK**

#### ② DefaultUserName（なければ作成）
- **種類：** 文字列値（REG_SZ）
- **値：** `SystemAV`

**手順**
1. 右側の何もないところで **右クリック**
2. **新規 → 文字列値**
3. 名前を次に変更

```
DefaultUserName
```

4. **DefaultUserName** をダブルクリック
5. **値のデータ** に `SystemAV` を入力
6. **OK**

#### ③ DefaultPassword（なければ作成）
- **種類：** 文字列値（REG_SZ）
- **値：** `kanrisya`

**手順**
1. 右側で **右クリック**
2. **新規 → 文字列値**
3. 名前を次に変更

```
DefaultPassword
```

4. **DefaultPassword** をダブルクリック
5. **値のデータ** に `kanrisya` を入力
6. **OK**

### ⑩-5 設定完了
1. レジストリエディターを閉じる
2. PCを再起動
3. **ログイン画面が出なければ成功**
4. **SystemAV に自動ログインされ、デスクトップが表示される**

### ⑩-6 失敗した場合の確認ポイント
- ログイン画面が出る場合
  - **DefaultPassword** の入力ミスが多い
- ユーザー名が違う場合
  - **DefaultUserName** の表記ミス
- それ以外
  - レジストリを再確認

### ⑩-7 本作業の完了条件（CODEX判定基準）
- 管理者アカウント **SystemAV** にパスワード `kanrisya` が設定されている
- 再起動後、自動ログインされる
- 手動操作なしで次工程（タスクスケジューラ起動）へ進める

### ⑩-8 変更しない事項（明記）
- 他ユーザー設定
- Windows Update 設定
- ファイアーウォール設定
- タスクスケジューラ設定
- `_TsuyamaSignage` フォルダ内容

---

## ⑪ 最終確認（必ずやる）

### ⑪-1 再起動
1. **Windowsマーク**
2. **電源アイコン**
3. **再起動**

### ⑪-2 確認
1. 何も触らず **1分待つ**
2. 自動で動画が **全画面表示** される
3. 出たら **成功**

---

## ⑫ 本CODEX指示の完了条件（必ず満たす）
以下すべてを満たしていることを確認する。

- タスクスケジューラが **30秒遅延** で確実に発火する
- 壁紙に **正しいサイネージ番号** が表示されている
- ディスプレイが **正しい縦向き** になっている
- **IPアドレスの下2桁** と **壁紙番号** が一致している
- 管理者アカウント設定手順の **「追加」表記** が修正済み

---

## ⑬ 変更しない事項（明記）
以下は **変更しない**。

- `_TsuyamaSignage` フォルダ構成
- Python / mpv の実行方式
- `app\signagePC\run_controller.bat` の内容
- `auto_play.py` のロジック
- タスクスケジューラ設定内容

---

## 自動起動の方法の違い（重要な考え方）
ここは **「なぜタスクスケジューラを使ったのか？」** を説明します。

### 方法① スタートアップフォルダにショートカットを入れる方法
**やり方**
- スタートアップ フォルダに `app\signagePC\run_controller.bat` のショートカットを置く

**特徴**
- **ログイン後に実行** される
- **ユーザーごと** の設定
- 設定は簡単

**問題点**
- ログインに失敗すると **起動しない**
- **権限が弱い**
- エラーが起きやすい

**👉 一般PC向け**

### 方法② タスクスケジューラを使う方法（今回採用）
**やり方**
- **ログオン時に** 直接 python.exe を実行

**特徴**
- **ログイン前でも動く**
- **管理者権限で動かせる**
- **再現性が高い**

**強み**
- **無人運用に最適**
- **停電・再起動に強い**
- **業務用PC向け**


**👉 今回は「タスクスケジューラが正解」**

---

## 困ったときはこれだけ覚える
- 動かない → **`C:\_TsuyamaSignage` をコピーし直す**
- 触っていいのは → **`content` フォルダだけ**
- それ以外は → **触らない**
